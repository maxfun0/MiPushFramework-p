name: Android Debug Build

on:
  workflow_dispatch:

jobs:
  debug:
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup Java
        uses: actions/setup-java@v4
        with:
          java-version: '11'
          distribution: 'temurin'
      
      - name: Create keystores
        run: |
          # 创建所有可能需要的密钥库
          keytool -genkeypair -v \
            -keystore debug.keystore \
            -alias androiddebugkey \
            -keyalg RSA \
            -keysize 2048 \
            -validity 10000 \
            -storepass android \
            -keypass android \
            -dname "CN=Android Debug,O=Android,C=US"
          
          # 创建多个副本
          cp debug.keystore .yuuta.jks
          cp debug.keystore release.keystore
          cp debug.keystore keystore.jks
      
      - name: Run diagnostic tasks
        run: |
          chmod +x gradlew
          
          echo "=== Gradle信息 ==="
          ./gradlew --version
          
          echo "=== 可用的构建变体 ==="
          ./gradlew tasks | grep -i assemble || echo "无法获取任务列表"
          
          echo "=== 项目结构 ==="
          find . -name "build.gradle" -o -name "build.gradle.kts" | head -10
          
          echo "=== 清理项目 ==="
          ./gradlew clean
          
          echo "=== 尝试构建 push 模块 ==="
          # 尝试不同的构建命令
          for variant in vc105Debug debug; do
            echo "尝试构建: $variant"
            ./gradlew :push:assemble${variant^} --stacktrace 2>&1 | tail -50 || true
          done
          
          echo "=== 最终检查 ==="
          find . -name "*.apk" -type f 2>/dev/null
